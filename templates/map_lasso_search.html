{% extends "base.html" %}
{% block body_classes %}full-screen{% endblock %}
{% block extra_css %}
  <link href="/static/stylesheets/vendor/ol.css" media="all" rel="stylesheet" type="text/css">
{% endblock %}
{% block landregistry_content %}
  <div class="map">
    <div class="ol-container"></div>
    <div class="map-info"></div>
  </div>

   <!--<div id="map" class="smallmap"></div><-->

   <form class="form-inline">
        <label>Geometry type &nbsp;</label>
          <select id="type">
            <option value="Point">Point</option>
            <option value="LineString">LineString</option>
            <option value="Polygon">Polygon</option>
          </select>
      </form>

    <button type="button" onclick="features()">Features</button>
    <p>Features:</p>
    <p id="features_3857_json"></p>
    <br>
    <p id="features_4326_json"></p>
    <form id="frm1" method="get" action="">
    </form>        

{% endblock %}
{% block extra_js %}
  <script>

    var raster = new ol.layer.Tile({
    source: new ol.source.MapQuest({layer: 'sat'})
    });

    var source = new ol.source.Vector();

    var vector = new ol.layer.Vector({
      source: source,
      name: "Polygon Layer",
      style: new ol.style.Style({
        fill: new ol.style.Fill({
          color: 'rgba(255, 255, 255, 0.2)'
        }),
        stroke: new ol.style.Stroke({
          color: '#ffcc33',
          width: 2
        }),
        image: new ol.style.Circle({
          radius: 7,
          fill: new ol.style.Fill({
            color: '#ffcc33'
          })
        })
      })
    });

    window.LR.mapLassoSearch = new window.LR.MapLassoSearch({
      el: '.ol-container',
      infoEl: '.map-info',
      geoUrl: '{{ geo_url }}'
    });

    var typeSelect = document.getElementById('type');
    var lasso;
    var draw; // global so we can remove it later
    function addInteraction() {
      draw = new ol.interaction.Draw({
        source: source,
        type: /** @type {ol.geom.GeometryType} */ (typeSelect.value)
      });
      window.LR.mapLassoSearch.map.addInteraction(draw);
    }


    /**
     * Let user change the geometry t
     * @param {Event} e Change event.
     */
    typeSelect.onchange = function(e) {
      window.LR.mapLassoSearch.map.removeInteraction(draw);
      addInteraction();
    };


    function features()
    {
        
        var layers = window.LR.mapLassoSearch.map.getLayers();
        var polyLayer = null;
        window.LR.mapLassoSearch.map.getLayers().forEach(function(layer) {
          if (layer.get('name') == 'Polygon Layer') {
             polyLayer = layer;
          }
        });
        source = polyLayer.getSource();
        features = source.getFeatures();
        polygonGeometry = features[0].getGeometry();
        var format = new ol.format.GeoJSON();
        featureGeoJSON = format.writeFeature(features[0]); 
        geometryGeoJSON = featureGeoJSON['geometry'];
        geometry4326String = JSON.stringify( geometryGeoJSON);               
        lasso = geometry4326String;
        
        window.LR.mapLassoSearch.search();
        

 
    }

    addInteraction(); 


  </script>
{% endblock %}
